# Spread Heads â€“ TestFlight 1.0.8

Release date: 2025-11-13

## ðŸš€ New Features
- **Master Picks**: New screen to make all your picks in one place and sync them across multiple leagues simultaneously
  - 3-column layout: Moneyline | Spread | Over/Under
  - Shows current ESPN lines
  - Automatically syncs to all selected leagues when submitted
  - Respects per-league lock times
  - Loads existing picks when you return
- **Server-Side Scoring**: Automated per-league scoring system
  - Points computed automatically as games finalize (no button needed)
  - Uses each league's locked lines for accurate grading
  - Spread and total picks graded against league-specific locked spreads/totals

## âœ… Improvements & Fixes
- **Pick Format Normalization**: All picks now store team abbreviations and standardized over/under values for consistency
- **Multi-League Sync**: Fixed issue where Master Picks only synced to 1 of 3 leagues
- **League UI Highlights**: League screens now correctly highlight your Master Picks selections
- **Offline Queue**: Fixed offline queue to properly handle week parameter when saving picks
- **Idempotent SQL**: Database migrations now run cleanly on re-execution

## ðŸ§ª What to Test
1. **Master Picks Flow**:
   - Navigate to Master Picks screen
   - Make picks across all three bet types (moneyline, spread, over/under)
   - Select multiple leagues and submit
   - Verify picks appear in each selected league
   - Return to Master Picks and confirm your selections are still visible

2. **Per-League Lock Times**:
   - Make Master Picks before games lock
   - Verify locked games don't sync to leagues where they're already locked
   - Confirm unlocked games still sync properly

3. **League Screens**:
   - View individual league screens after using Master Picks
   - Verify buttons highlight correctly for picks made via Master Picks
   - Make picks directly in a league and confirm they work independently

4. **Scoring** (when games finalize this week):
   - Check that points appear automatically after games end
   - Verify leaderboard updates without manual refresh
   - Confirm each league scores using its own locked lines

## ðŸ›  Tech Notes
- Added `MasterPicksScreen.js` with grouped game display by lock time
- Enhanced `compute_weekly_points` SQL function to read `leagues.locked_lines` per game
- Added database trigger `trg_recompute_weekly_points_on_game_final` for automatic scoring
- Pick storage now uses abbreviations (e.g., "KC" instead of "Kansas City Chiefs")
- Total picks stored as lowercase 'over'/'under' for database compatibility

## ðŸ“Œ Known / Next
- Server scoring indicator (cached vs fallback) not yet shown in UI
- Client-side fallback grading doesn't yet use locked lines (matches server only when lines identical)
- Game results ingestion relies on existing scoreboard data flow

Let us know if Master Picks doesn't sync to all your leagues or if any picks disappear when switching between screens!
